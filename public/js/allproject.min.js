var app = new Vue({
    el: '#app',
    data: {
        data: {}
    }
});
$(document).ready(function () {
    /* handle tables */
    // var idwork = $('#work').val();
    // alert(idwork);
    var table = $('#options-table').DataTable({

        responsive: true,
        scrollY: "true",
        scrollX: "true",
        processing: true,
        serverSide: true,
        ajax: APP_URL + '/service/datatablesallproject/',

        columns: [

            {
                data: "service_code",

                render: function (data, type, row, meta) {
                    var i;
                    var number = '';
                    for (i = 3; i > data.length; i--) {
                        number = number + '0';
                    }
                    var code = number + data;
                    if (row['service_status'] == "รอเสนอราคา/มัดจำ") { var link = "pledgeD"; }
                    else if (row['service_status'] == "ออกแบบ") { var link = "designD"; }
                    else if (row['service_status'] == "รอเสนอราคา") { var link = "waitpriceD"; }
                    else if (row['service_status'] == "เสนอราคาก่อสร้าง") { var link = "waitbuildD"; }
                    else if (row['service_status'] == "ก่อสร้าง") { var link = "buildD"; }
                    else if (row['service_status'] == "ประกัน") { var link = "garunteeD"; }
                    else if (row['service_status'] == "จบแล้ว") { var link = "endprojectD"; }
                    else if (row['service_status'] == "การรังวัด") { var link = "surveyD"; }
                    var btnView = '<a href="/service/' + link + '/' + row['service_id'] + '"  title="รายละเอียด">' + code + '</a> ';
                    if (row['service_status'] == "ไม่สนใจบริการ") { var btnView = '';}
                    return btnView;
                },
            },
            {
                data: 'workname',
                name: 'workname',
                className: "text-left",
                render: function (data, type, row) {

                    if (row['service_status'] == "รอเสนอราคา/มัดจำ") { var link = "pledgeD"; }
                    else if (row['service_status'] == "ออกแบบ") { var link = "designD"; }
                    else if (row['service_status'] == "รอเสนอราคา") { var link = "waitpriceD"; }
                    else if (row['service_status'] == "เสนอราคาก่อสร้าง") { var link = "waitbuildD"; }
                    else if (row['service_status'] == "ก่อสร้าง") { var link = "buildD"; }
                    else if (row['service_status'] == "ประกัน") { var link = "garunteeD"; }
                    else if (row['service_status'] == "จบแล้ว") { var link = "endprojectD"; }
                    else if (row['service_status'] == "การรังวัด") { var link = "surveyD"; }
                    var btnView = '<a href="/service/' + link + '/' + row['service_id'] + '"   title="รายละเอียด">' + data + '</a> ';
                    if (row['service_status'] == "ไม่สนใจบริการ") { var btnView = ''; }
                    return btnView;
                },
            },
            {
                data: 'namec',
                name: 'namec',
                render: function (data, type, row) {

                    if (row['service_status'] == "รอเสนอราคา/มัดจำ") { var link = "pledgeD"; }
                    else if (row['service_status'] == "ออกแบบ") { var link = "designD"; }
                    else if (row['service_status'] == "รอเสนอราคา") { var link = "waitpriceD"; }
                    else if (row['service_status'] == "เสนอราคาก่อสร้าง") { var link = "waitbuildD"; }
                    else if (row['service_status'] == "ก่อสร้าง") { var link = "buildD"; }
                    else if (row['service_status'] == "ประกัน") { var link = "garunteeD"; }
                    else if (row['service_status'] == "จบแล้ว") { var link = "endprojectD"; }
                    else if (row['service_status'] == "การรังวัด") { var link = "surveyD"; }
                    var btnView = '<a href="/service/' + link + '/' + row['service_id'] + '"   title="รายละเอียด">' + data + '</a> ';
                    if (row['service_status'] == "ไม่สนใจบริการ") { var btnView = ''; }
                    return btnView;
                },
            },
            {
                data: 'service_status',
                name: 'service_status',
                render: function (data, type, row) {

                    if (row['service_status'] == "รอเสนอราคา/มัดจำ") { var link = "pledgeD"; }
                    else if (row['service_status'] == "ออกแบบ") { var link = "designD"; }
                    else if (row['service_status'] == "รอเสนอราคา") { var link = "waitpriceD"; }
                    else if (row['service_status'] == "เสนอราคาก่อสร้าง") { var link = "waitbuildD"; }
                    else if (row['service_status'] == "ก่อสร้าง") { var link = "buildD"; }
                    else if (row['service_status'] == "ประกัน") { var link = "garunteeD"; }
                    else if (row['service_status'] == "จบแล้ว") { var link = "endprojectD"; }
                    else if (row['service_status'] == "การรังวัด") { var link = "surveyD"; }
                    var btnView = '<a href="/service/' + link + '/' + row['service_id'] + '"   title="รายละเอียด">' + row['service_status'] + '</a> ';
                    if (row['service_status'] == "ไม่สนใจบริการ") { var btnView = ''; }
                    return btnView;
                },
            },
            {
                data: 'name',
                name: 'name',
                render: function (data, type, row) {

                    if (row['service_status'] == "รอเสนอราคา/มัดจำ") { var link = "pledgeD"; }
                    else if (row['service_status'] == "ออกแบบ") { var link = "designD"; }
                    else if (row['service_status'] == "รอเสนอราคา") { var link = "waitpriceD"; }
                    else if (row['service_status'] == "เสนอราคาก่อสร้าง") { var link = "waitbuildD"; }
                    else if (row['service_status'] == "ก่อสร้าง") { var link = "buildD"; }
                    else if (row['service_status'] == "ประกัน") { var link = "garunteeD"; }
                    else if (row['service_status'] == "จบแล้ว") { var link = "endprojectD"; }
                    else if (row['service_status'] == "การรังวัด") { var link = "surveyD"; }
                    var btnView = '<a href="/service/' + link + '/' + row['service_id'] + '"   title="รายละเอียด">' + data + '</a> ';
                    if (row['service_status'] == "ไม่สนใจบริการ") { var btnView = ''; }
                    return btnView;
                },
            },
            // {
            //     data: 'endgaruntee',
            //     name: 'endgaruntee',
            //     render: function (data, type, row) {
            //         var myDate = new Date(data);
            //         var dd = myDate.getDate();
            //         var mm = myDate.getMonth() + 1;
            //         if (dd < 10) {
            //             dd = '0' + dd;
            //         }
            //         if (mm < 10) {
            //             mm = '0' + mm;
            //         }
            //         var date = dd + "-" + mm + "-" + myDate.getFullYear();
            //         var btnView = '<a href="/service/endprojectD/' + row['service_id'] + '"  title="รายละเอียด">' + date + '</a> ';
            //         return btnView;
            //     },
            // },
            // {
            //     data: 'endgaruntee',
            //     name: 'endgaruntee',
            //     render: function (data, type, row) {
            //         var myDate = new Date(data);
                    
            //         var today = new Date();
            //         var myDate1 = myDate.getFullYear() + '-' + (myDate.getMonth() + 1) + '-' + myDate.getDate();
            //         var myDate2 = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
                   
            //         date1 = myDate1.split('-');
            //         date2 = myDate2.split('-');

            //         // Now we convert the array to a Date object, which has several helpful methods
            //         date1 = new Date(date1[0], date1[1], date1[2]);
            //         date2 = new Date(date2[0], date2[1], date2[2]);

            //         // We use the getTime() method and get the unixtime (in milliseconds, but we want seconds, therefore we divide it through 1000)
            //         date1_unixtime = parseInt(date1.getTime() / 1000);
            //         date2_unixtime = parseInt(date2.getTime() / 1000);

            //         // This is the calculated difference in seconds
            //         var timeDifference = date1_unixtime - date2_unixtime;

            //         // in Hours
            //         var timeDifferenceInHours = timeDifference / 60 / 60;

            //         // and finaly, in days :)
            //         var timeDifferenceInDays = timeDifferenceInHours / 24;

            //        // alert(timeDifferenceInDays);

                    
            //         // var dd = myDate.getDate();  
                 
            //         // var mm = myDate.getMonth() + 1;
            //         // if (dd < 10) {
            //         //     dd = '0' + dd;
            //         // }
            //         // if (mm < 10) {
            //         //     mm = '0' + mm;
            //         // }
            //         var date = timeDifferenceInDays;
            //         var btnView = '<a href="/service/endprojectD/' + row['service_id'] + '"  title="รายละเอียด">' + date + '</a> ';
            //         return btnView;
            //     },
            // },
            {
                data: 'service_id',
                name: 'service_id'
            }, {

                data: 'service_id',
                orderable: false,
                render: function (data, type, row) {
                    textdata = '';
                    return textdata;
                },
            }
        ],

        columnDefs: [{
            targets: 5,
            orderable: false,
            render: function (data, type, row) {
                var dataName = row['namec'];
                if (row['locationc']) {
                    var btnLocation = '<a href="' + row['locationc'] + '" target="_blank"  class="btn btn-outline-dark btn-sm" title="สถานที่"><i class="fas fa-map-marker-alt"></i></a> ';
                } else { var btnLocation = ''; }
                // var btnGear = '<a "#" data-href="garunteestatus/' + data + '"  data-modal-name="ajaxModal"  class="btn btn-outline-dark btn-sm btn-create" role="button" title="ตั้งค่า"><i class="fas fa-cog"></i></a> ';
                // var btnEdit = '<a href="/service/surveyD/' + data + '"  class="btn btn-outline-dark btn-sm" title="แก้ไข"><i class="fa fa-edit"></i></a> ';
                // var btnDelete = '<a href="#" data-href="' + APP_URL + '/service/pledge/' + data + '" data-id="' + data + '" data-name="' + dataName + '" role="button" class="btn btn-outline-danger btn-sm btn-delete" title="ลบ"><i class="fa fa-trash"></i></a>';
                // var btnView = '<a href="#" data-href="' + APP_URL + '/user/view/' + row.id + '" data-modal-name="ajaxModal" data-id="' + row.id + '" class="btn-edit">' + data + '</a> ';
                // btnDelete = APP_USERID != data ? btnDelete : '';
                return btnLocation ;
            },
        }]
    });

    /* handle tables */

    /* handle validate */
    $('#saveForm').on('shown.bs.modal', function (e) {
        $('#saveForm').validate({
            submitHandler: function (form) {
                var id = $('input[name=id]').val();
                var url = APP_URL + '/pledgestatusu';
                saveForm(id, url, table);
            },
            rules: {
                pledge_status: {
                    required: true
                }
            },

            errorElement: 'span',
            errorPlacement: function (error, element) {
                error.addClass("error-block");
                error.addClass("invalid-feedback");
                if (element.prop("type") === "checkbox") {
                    error.insertAfter(element.parent("label"));
                } else if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent()); /* radio checkbox? */
                } else if (element.hasClass('select2')) {
                    error.insertAfter(element.next('span')); /* select2 */
                } else {
                    error.insertAfter(element);
                }
            },
            highlight: function (element, errorClass, validClass) {
                $(element).parents('.form-group').addClass('has-error').removeClass('has-success');
                $(element).addClass('is-invalid').removeClass('is-valid');
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).parents('.form-group').addClass('has-success').removeClass('has-error');
                $(element).addClass('is-valid').removeClass('is-invalid');
            }
        });
    });



    //สร้างปุ่มใน Datatable
    /* handle delete */
    $('body').on('click', '.btn-delete', function (e) {
        e.preventDefault();
        var url = $(this).data('href');
        var name = $(this).data('name');
        var callback = function () {
            deleteForm(url, table);
        }

        confirmBox('ลบข้อมูล ' + name, callback);
    });
});
